!function(){let e;delete window.$;try{e=webpackChunkdiscord_app.push([[Symbol()],{},e=>e]),webpackChunkdiscord_app.pop()}catch(e){return console.error("Failed to get webpack modules. Ensure you're in Discord.",e),void alert("An error occurred. Make sure you are in Discord and try again.")}const r=Object.values(e.c).find((e=>e?.exports?.tn?.get))?.exports.tn;if(!r)return console.error("Discord API object not found. The script might be outdated or Discord's structure has changed."),void alert("Could not find the Discord API. The script may be outdated.");const t=window.location.pathname.split("/")[3],n=window.location.pathname.split("/")[2];if(!t&&!n)return void alert("Invalid channel or guild. Please run this script within a Discord channel or guild.");async function s(){try{const e=await r.get({url:"/users/@me"});return{id:e.body.id,username:e.body.global_name||e.body.username}}catch(e){throw console.error("Error fetching user info:",e),new Error(`Failed to fetch user information: ${e.message}`)}}async function o(e,n){try{const s=await r.get({url:`/channels/${t}/messages/search?min_id=0&author_id=${e}`});if(!s.ok)throw new Error(`API returned ${s.status} ${s.statusText}`);return{username:n,userId:e,messageCount:s.body.total_results}}catch(r){throw console.error(`Error fetching message count for ${n} (${e}):`,r),new Error(`Failed to fetch message count for ${n}: ${r.message}`)}}async function a(e){try{const n=await r.post({url:`/channels/${t}/messages`,body:e});if(!n.ok)throw new Error(`API returned ${n.status} ${n.statusText}`);return n}catch(e){throw console.error("Error sending message:",e),new Error(`Failed to send message: ${e.message}`)}}n&&!isNaN(n)?alert("This script is currently designed for Direct Messages and Group Chats. Guild functionality is under development."):t&&!isNaN(t)?async function(e){try{const t=await r.get({url:`/channels/${e}/messages/search?min_id=0`});if(!t?.body?.channels?.[0])throw new Error("Invalid or empty channel data received.");const n=t.body.channels[0].type;if(1===n)return async function(e){if(!e?.channels?.[0]?.recipients){const r="Invalid data for DM leaderboard processing.";throw console.error(r,e),new Error(r)}const r=await s(),t=e.channels[0].recipients.find((e=>e.id!==r.id));if(!t){const e="No other user found in this direct message channel.";return console.warn(e),a({content:e,tts:!1})}const n=e.total_results,c=t.global_name||t.username,[i,d]=await Promise.all([o(r.id,r.username),o(t.id,c)]),u=[i,d].sort(((e,r)=>r.messageCount-e.messageCount));let l=n-(i.messageCount+d.messageCount),h=`**DM with ${c}**\n**Total messages:** ${n}\n\n**Leaderboard:** 🏆\n`;if(u.forEach(((e,r)=>{const t=(e.messageCount/n*100).toFixed(1);h+=`${r+1}. **${e.username}**: ${e.messageCount} (${t}%)\n`})),l>0){const e=(l/n*100).toFixed(1);h+=`-# Other: ${l} (${e}%)\n`}return await a({content:h,tts:!1})}(t.body);if(3===n)return async function(e){if(!e?.channels?.[0]?.recipients){const r="Invalid data for group message leaderboard processing.";throw console.error(r,e),new Error(r)}const r=e.channels[0],t=r.name||"Unnamed Group Chat",n=e.total_results,c=r.recipients||[],i=await s(),d=[...c.filter((e=>e.id!==i.id)),i],u=[];if(await Promise.all(d.map((async e=>{const r=e.global_name||e.username;try{const t=await o(e.id,r);u.push(t)}catch(e){console.warn(`Could not fetch message count for ${r}: ${e.message}`)}}))),0===u.length){const e="No message data could be retrieved for this group chat.";return console.warn(e),a({content:e,tts:!1})}u.sort(((e,r)=>r.messageCount-e.messageCount));let l=u.reduce(((e,r)=>e+r.messageCount),0),h=n-l,m=`**Group Name:** ${t}\n**Total messages:** ${n}\n\n**Leaderboard:** 🏆\n`;if(u.forEach(((e,r)=>{const t=(e.messageCount/n*100).toFixed(1);m+=`${r+1}. **${e.username}**: ${e.messageCount} (${t}%)\n`})),h>0){const e=(h/n*100).toFixed(1);m+=`-# Other: ${h} (${e}%)\n`}return await a({content:m,tts:!1})}(t.body);throw alert("This script supports Direct Messages and Group Chats only."),new Error(`Unsupported channel type: ${n}`)}catch(e){console.error("Error fetching or processing channel data:",e),alert(`An error occurred: ${e.message}. Please check the console for more details.`)}}(t):alert("Invalid channel ID. Please run this script in a Discord channel.")}();